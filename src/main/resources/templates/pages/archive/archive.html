<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìë£Œì‹¤ â€” WorkSpace</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="app-wrap">
  <div th:replace="~{fragments/sidebar :: sidebar}"></div>
  <div class="main-content">
    <header th:replace="~{fragments/header :: topbar(title='ìë£Œì‹¤')}"></header>
    <div class="content-body">

      <div class="page-header">
        <div>
          <div class="page-title">ğŸ“ ìë£Œì‹¤</div>
          <div class="page-sub">ì‚¬ë‚´ ë¬¸ì„œ, ì–‘ì‹, ì°¸ê³ ìë£Œë¥¼ ê³µìœ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤</div>
        </div>
        <a th:href="@{/board/archive/write}" class="btn btn-primary">â¬†ï¸ ìë£Œ ì—…ë¡œë“œ</a>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
      <div class="cat-tabs">
        <a th:href="@{/board/archive}" class="cat-tab" th:classappend="${category == null or category == ''} ? 'active'">ì „ì²´</a>
        <a th:href="@{/board/archive(category='HR')}" class="cat-tab" th:classappend="${category == 'HR'} ? 'active'">ì¸ì‚¬/ì´ë¬´</a>
        <a th:href="@{/board/archive(category='DEV')}" class="cat-tab" th:classappend="${category == 'DEV'} ? 'active'">ê°œë°œ/ê¸°ìˆ </a>
        <a th:href="@{/board/archive(category='PLAN')}" class="cat-tab" th:classappend="${category == 'PLAN'} ? 'active'">ê¸°íš/ë§ˆì¼€íŒ…</a>
        <a th:href="@{/board/archive(category='FIN')}" class="cat-tab" th:classappend="${category == 'FIN'} ? 'active'">ì¬ë¬´/íšŒê³„</a>
        <a th:href="@{/board/archive(category='FORM')}" class="cat-tab" th:classappend="${category == 'FORM'} ? 'active'">ì‚¬ë‚´ ì–‘ì‹</a>
      </div>

      <!-- íˆ´ë°” -->
      <div class="toolbar">
        <form th:action="@{/board/archive}" method="get" style="display:flex;gap:9px;flex:1;">
          <input type="hidden" name="category" th:value="${category}">
          <div class="search-wrap">
            <span class="si">ğŸ”</span>
            <input type="text" name="keyword" th:value="${keyword}" placeholder="íŒŒì¼ëª…, ì„¤ëª…ìœ¼ë¡œ ê²€ìƒ‰...">
          </div>
          <select name="ext" class="filter-select">
            <option value="">ì „ì²´ í˜•ì‹</option>
            <option value="pdf" th:selected="${ext == 'pdf'}">PDF</option>
            <option value="xlsx" th:selected="${ext == 'xlsx'}">Excel</option>
            <option value="docx" th:selected="${ext == 'docx'}">Word</option>
            <option value="pptx" th:selected="${ext == 'pptx'}">PPT</option>
            <option value="zip" th:selected="${ext == 'zip'}">ZIP</option>
          </select>
          <select name="sort" class="filter-select">
            <option value="latest" th:selected="${sort == 'latest'}">ìµœì‹ ìˆœ</option>
            <option value="download" th:selected="${sort == 'download'}">ë‹¤ìš´ë¡œë“œìˆœ</option>
            <option value="name" th:selected="${sort == 'name'}">ì´ë¦„ìˆœ</option>
          </select>
          <button type="submit" class="btn btn-outline btn-sm">ê²€ìƒ‰</button>
        </form>
        <!-- ë·° ì „í™˜ -->
        <div class="view-toggle">
          <button class="view-btn active" id="btn-grid" onclick="setView('grid')" title="ê·¸ë¦¬ë“œ">âŠ</button>
          <button class="view-btn" id="btn-table" onclick="setView('table')" title="ëª©ë¡">â˜°</button>
        </div>
      </div>

      <!-- ê·¸ë¦¬ë“œ ë·° -->
      <div id="view-grid" class="archive-grid">
        <!-- th:each="file : ${list}" -->
        <div th:each="file : ${list}"
             th:class="'archive-card ' + ${file.fileExt}"
             th:onclick="|location.href='@{/board/archive/detail(id=${file.boardId})}'|">
          <div class="file-icon-big">
            <span th:switch="${file.fileExt}">
              <span th:case="'pdf'">ğŸ“„</span>
              <span th:case="'xlsx'">ğŸ“Š</span>
              <span th:case="'docx'">ğŸ“</span>
              <span th:case="'pptx'">ğŸ“Š</span>
              <span th:case="'zip'">ğŸ—œ</span>
              <span th:case="*">ğŸ“</span>
            </span>
          </div>
          <div class="arc-filename" th:text="${file.originalName}">íŒŒì¼ëª….pdf</div>
          <div class="arc-meta">
            <span th:text="${file.writerName}">ì´ë¬´íŒ€</span>
            <span th:text="${file.fileSize}">245KB</span>
          </div>
          <div class="arc-meta" style="margin-top:3px;">
            <span th:text="${#temporals.format(file.createdAt,'yyyy.MM.dd')}">2025.06.10</span>
            <span>â¬‡ <span th:text="${file.downloadCount}">0</span></span>
          </div>
          <div class="arc-actions">
            <button class="btn btn-outline btn-xs" onclick="event.stopPropagation();">ìƒì„¸ë³´ê¸°</button>
            <a th:href="@{/file/download(fileId=${file.fileId})}"
               class="btn btn-primary btn-xs" onclick="event.stopPropagation();">ë‹¤ìš´ë¡œë“œ</a>
          </div>
        </div>
        <!-- ëª©ë¡ ì—†ì„ ë•Œ -->
        <div th:if="${#lists.isEmpty(list)}" style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted);">
          ë“±ë¡ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>

      <!-- í…Œì´ë¸” ë·° -->
      <div id="view-table" style="display:none;">
        <div class="card">
          <div class="card-body" style="padding:0;">
            <table class="data-table">
              <thead>
                <tr>
                  <th style="width:55px;">ë²ˆí˜¸</th>
                  <th>íŒŒì¼ëª…</th>
                  <th style="width:90px;">ì¹´í…Œê³ ë¦¬</th>
                  <th style="width:80px;">ì—…ë¡œë”</th>
                  <th style="width:70px;">í¬ê¸°</th>
                  <th style="width:100px;">ì—…ë¡œë“œì¼</th>
                  <th style="width:65px;">ë‹¤ìš´ë¡œë“œ</th>
                  <th style="width:80px;">ì•¡ì…˜</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="file : ${list}"
                    th:onclick="|location.href='@{/board/archive/detail(id=${file.boardId})}'|">
                  <td class="muted" th:text="${file.boardId}">1</td>
                  <td>
                    <div style="display:flex;align-items:center;gap:11px;">
                      <div th:class="'arc-ext-badge ext-' + ${file.fileExt}" th:text="${#strings.toUpperCase(file.fileExt)}">PDF</div>
                      <div>
                        <div class="bold" th:text="${file.originalName}">íŒŒì¼ëª….pdf</div>
                        <div style="font-size:11px;color:var(--text-muted);margin-top:2px;" th:text="${file.description}">ì„¤ëª…</div>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge badge-gray" th:text="${file.categoryName}">ì¹´í…Œê³ ë¦¬</span></td>
                  <td class="muted" th:text="${file.writerName}">ì—…ë¡œë”</td>
                  <td class="muted" th:text="${file.fileSize}">245KB</td>
                  <td class="muted" th:text="${#temporals.format(file.createdAt,'yyyy.MM.dd')}">2025.06.10</td>
                  <td class="muted" th:text="${file.downloadCount + 'íšŒ'}">0íšŒ</td>
                  <td>
                    <a th:href="@{/file/download(fileId=${file.fileId})}"
                       class="btn btn-primary btn-xs" onclick="event.stopPropagation();">â¬‡ ë‹¤ìš´</a>
                  </td>
                </tr>
                <tr th:if="${#lists.isEmpty(list)}">
                  <td colspan="8" style="text-align:center;padding:40px;color:var(--text-muted);">ë“±ë¡ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div class="pagination">
              <button class="pg-btn"
                      th:onclick="${currentPage <= 1} ? null : |location.href='@{/board/archive(page=${currentPage-1},keyword=${keyword},category=${category})}'|">â€¹</button>
              <button class="pg-btn"
                      th:each="i : ${#numbers.sequence(startPage, endPage)}"
                      th:text="${i}"
                      th:classappend="${i == currentPage} ? 'active'"
                      th:onclick="|location.href='@{/board/archive(page=${i},keyword=${keyword},category=${category})}'|">1</button>
              <button class="pg-btn"
                      th:onclick="${currentPage >= totalPages} ? null : |location.href='@{/board/archive(page=${currentPage+1},keyword=${keyword},category=${category})}'|">â€º</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<script th:src="@{/js/script.js}"></script>
<script>
function setView(mode) {
  const grid = document.getElementById('view-grid');
  const table = document.getElementById('view-table');
  const btnGrid = document.getElementById('btn-grid');
  const btnTable = document.getElementById('btn-table');
  if (mode === 'grid') {
    grid.style.display = 'grid'; table.style.display = 'none';
    btnGrid.classList.add('active'); btnTable.classList.remove('active');
  } else {
    grid.style.display = 'none'; table.style.display = 'block';
    btnTable.classList.add('active'); btnGrid.classList.remove('active');
  }
}
</script>
</body>
</html>
