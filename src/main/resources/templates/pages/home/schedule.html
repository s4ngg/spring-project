<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¼ì • ìº˜ë¦°ë” â€” WorkSpace</title>
<link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
	<div class="app-wrap">
		<div th:replace="~{fragments/sidebar :: sidebar}"></div>
		<div class="main-content">
			<header th:replace="~{fragments/header :: topbar(title='ì¼ì • ìº˜ë¦°ë”')}"></header>
			<div class="content-body">

				<div class="page-header">
					<div>
						<div class="page-title">ğŸ“… ì¼ì • ìº˜ë¦°ë”</div>
						<div class="page-sub">ë‚˜ì˜ ì¼ì •ì„ ë“±ë¡í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</div>
					</div>
					<button class="btn btn-primary"
						th:onclick="${session.LOGIN_MEMBER != null} ? 'openModal()' : 'alert(\'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!\')'">
						+ ì¼ì • ë“±ë¡</button>
				</div>

				<!-- ì¼ì • ëª©ë¡ ì¹´ë“œ -->
				<div class="card">
					<div class="card-header">
						<span class="card-title">ğŸ“‹ ì „ì²´ ì¼ì •</span> <select
							class="filter-select">
							<option value="">ì „ì²´</option>
							<option value="public">ê³µê°œ</option>
							<option value="private">ë¹„ê³µê°œ</option>
						</select>
					</div>
					<div class="card-body" style="padding: 0;">
						<table class="data-table">
							<thead>
								<tr>
									<th style="width: 60px;">ë²ˆí˜¸</th>
									<th>ì œëª©</th>
									<th style="width: 160px;">ì‹œì‘ì¼ì‹œ</th>
									<th style="width: 160px;">ì¢…ë£Œì¼ì‹œ</th>
									<th style="width: 70px;">ê³µê°œì—¬ë¶€</th>
									<th style="width: 120px;">í™•ì¸ ë° ì‚­ì œ</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="schedule : ${list}">
									<td class="muted" th:text="${schedule.scheduleId}">1</td>
									<td class="bold" th:text="${schedule.title}">ì¼ì • ì œëª©</td>
									<td class="muted"
										th:text="${#temporals.format(schedule.startDt, 'yyyy.MM.dd HH:mm')}">2025.06.20
										09:00</td>
									<td class="muted"
										th:text="${#temporals.format(schedule.endAt, 'yyyy.MM.dd HH:mm')}">2025.06.20
										18:00</td>
									<td><span class="badge badge-blue"
										th:if="${schedule.isPublic}">ê³µê°œ</span> <span
										class="badge badge-gray" th:unless="${schedule.isPublic}">ë¹„ê³µê°œ</span>
									</td>
									<td style="display: flex; gap: 6px;">
									<td style="display: flex; gap: 6px;">
										<!-- ìƒì„¸ ë³´ê¸° ë²„íŠ¼ -->
										<button class="btn btn-outline btn-xs"
											th:attr="data-id=${schedule.scheduleId},
             data-title=${schedule.title},
             data-content=${schedule.content},
             data-start=${#temporals.format(schedule.startDt, 'yyyy.MM.dd HH:mm')},
             data-end=${#temporals.format(schedule.endAt, 'yyyy.MM.dd HH:mm')},
             data-public=${schedule.isPublic}"
											onclick="openDetail(this)">í™•ì¸</button> <!-- ë³¸ì¸ ì¼ì •ë§Œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ -->
										<form
											th:if="${session.LOGIN_MEMBER.employeeNo == schedule.employeeNo}"
											th:action="@{/schedule/delete/{id}(id=${schedule.scheduleId})}"
											method="post" style="display: inline;"
											onsubmit="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
											<button type="submit" class="btn btn-danger btn-xs">ì‚­ì œ</button>
										</form>
									</td>
								</tr>
								<tr th:if="${#lists.isEmpty(list)}">
									<td colspan="6"
										style="text-align: center; padding: 40px; color: var(--text-muted);">
										ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- ì¼ì • ë“±ë¡ ëª¨ë‹¬ -->
				<div id="schedule-modal"
					style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.4); z-index: 999; align-items: center; justify-content: center;">
					<div class="card" style="width: 520px; max-width: 90%;">
						<div class="card-header">
							<span class="card-title">ğŸ“… ì¼ì • ë“±ë¡</span>
							<button onclick="closeModal()"
								style="font-size: 18px; color: var(--text-muted); cursor: pointer;">âœ•</button>
						</div>
						<div class="card-body">
							<form th:action="@{/schedule/create}" method="post">
								<div class="form-group">
									<label class="form-label">ì œëª© *</label> <input type="text"
										name="title" class="form-control" placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
										required>
								</div>
								<div class="form-group">
									<label class="form-label">ë‚´ìš©</label>
									<textarea name="content" class="editor-area"
										style="min-height: 100px;" placeholder="ì¼ì • ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
								</div>
								<div class="form-row">
									<div class="form-group">
										<label class="form-label">ì‹œì‘ ì¼ì‹œ *</label> <input
											type="datetime-local" id="startDt" name="startDt"
											class="form-control" required
											onchange="setMinEndDate(this.value)">
									</div>
									<div class="form-group">
										<label class="form-label">ì¢…ë£Œ ì¼ì‹œ *</label> <input
											type="datetime-local" id="endAt" name="endAt"
											class="form-control" required>
									</div>
								</div>
								<div class="form-group">
									<label
										style="display: flex; align-items: center; gap: 7px; font-size: 13px; color: var(--text-sub); cursor: pointer;">
										<input type="checkbox" name="isPublic" value="true"
										style="accent-color: var(--accent);"> ì „ì²´ ê³µê°œ
									</label>
								</div>
								<div class="form-actions">
									<button type="button" class="btn btn-outline"
										onclick="closeModal()">ì·¨ì†Œ</button>
									<button type="submit" class="btn btn-primary">ë“±ë¡</button>
								</div>
							</form>
						</div>
					</div>
				</div>

				<!-- ì¼ì • ìƒì„¸ ëª¨ë‹¬ -->
				<div id="detail-modal"
					style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.4); z-index: 999; align-items: center; justify-content: center;">
					<div class="card" style="width: 520px; max-width: 90%;">
						<div class="card-header">
							<span class="card-title">ğŸ“… ì¼ì • ìƒì„¸</span>
							<button onclick="closeDetail()"
								style="font-size: 18px; color: var(--text-muted); cursor: pointer;">âœ•</button>
						</div>
						<div class="card-body">
							<div style="display: flex; flex-direction: column; gap: 13px;">
								<div>
									<div class="field-label">ì œëª©</div>
									<div class="field-value" id="detail-title"></div>
								</div>
								<div>
									<div class="field-label">ë‚´ìš©</div>
									<div class="field-value" id="detail-content"></div>
								</div>
								<div
									style="display: grid; grid-template-columns: 1fr 1fr; gap: 11px;">
									<div>
										<div class="field-label">ì‹œì‘ ì¼ì‹œ</div>
										<div class="field-value" id="detail-start"
											style="color: var(--accent); font-weight: 700;"></div>
									</div>
									<div>
										<div class="field-label">ì¢…ë£Œ ì¼ì‹œ</div>
										<div class="field-value" id="detail-end"></div>
									</div>
								</div>
								<div>
									<div class="field-label">ê³µê°œ ì—¬ë¶€</div>
									<div id="detail-public"></div>
								</div>
							</div>
							<div class="form-actions" style="margin-top: 18px;">
								<button class="btn btn-outline" onclick="closeDetail()">ë‹«ê¸°</button>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
	<script th:src="@{/js/script.js}"></script>
	<script>
  // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì‹œì‘ì¼ì‹œ ìµœì†Ÿê°’ìœ¼ë¡œ ì„¤ì •
  window.onload = function () {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const mi = String(now.getMinutes()).padStart(2, '0');
    const minVal = `${yyyy}-${mm}-${dd}T${hh}:${mi}`;
    document.getElementById('startDt').min = minVal;
  };

  // ì‹œì‘ì¼ì‹œ ì„ íƒí•˜ë©´ ì¢…ë£Œì¼ì‹œ ìµœì†Ÿê°’ ìë™ ì„¤ì •
  function setMinEndDate(val) {
    const endInput = document.getElementById('endAt');
    endInput.min = val;
    if (endInput.value && endInput.value < val) {
      endInput.value = val;
    }
  }

  // ë“±ë¡ ëª¨ë‹¬
  function openModal() {
    document.getElementById('schedule-modal').style.display = 'flex';
  }
  function closeModal() {
    document.getElementById('schedule-modal').style.display = 'none';
  }

  // ìƒì„¸ ëª¨ë‹¬
  function openDetail(btn) {
  document.getElementById('detail-title').textContent = btn.getAttribute('data-title');
  document.getElementById('detail-content').textContent = btn.getAttribute('data-content') || '(ë‚´ìš© ì—†ìŒ)';
  document.getElementById('detail-start').textContent = btn.getAttribute('data-start');
  document.getElementById('detail-end').textContent = btn.getAttribute('data-end');

  const isPublic = btn.getAttribute('data-public');
  document.getElementById('detail-public').innerHTML =
    (isPublic === 'true' || isPublic === true)
      ? '<span class="badge badge-blue">ê³µê°œ</span>'
      : '<span class="badge badge-gray">ë¹„ê³µê°œ</span>';

  document.getElementById('detail-modal').style.display = 'flex';
}
function closeDetail() {
  document.getElementById('detail-modal').style.display = 'none';
}
  function closeDetail() {
    document.getElementById('detail-modal').style.display = 'none';
  }

  // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
  document.getElementById('schedule-modal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });
  document.getElementById('detail-modal').addEventListener('click', function(e) {
    if (e.target === this) closeDetail();
  });
</script>
</body>
</html>