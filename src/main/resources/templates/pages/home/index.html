<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í™ˆ ëŒ€ì‹œë³´ë“œ â€” WorkSpace</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="app-wrap">

  <div th:replace="~{fragments/sidebar :: sidebar}"></div>

  <div class="main-content">
    <header th:replace="~{fragments/header :: topbar(title='í™ˆ ëŒ€ì‹œë³´ë“œ')}"></header>

    <div class="content-body">
      <div class="page-header">
        <div>
          <div class="page-title" th:if="${session.LOGIN_MEMBER != null}">
            ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”,
            <span th:text="${session.LOGIN_MEMBER.name}">í™ê¸¸ë™</span>
            <span th:text="${session.LOGIN_MEMBER.gradeName}">ê³¼ì¥</span>ë‹˜!
          </div>
          <div class="page-title" th:unless="${session.LOGIN_MEMBER != null}">
            ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
          </div>
          <div class="page-sub"
               th:text="${#temporals.format(today, 'yyyyë…„ MMì›” ddì¼ EEEE', new java.util.Locale('ko'))}">2025ë…„ 6ì›” 20ì¼ ê¸ˆìš”ì¼</div>
        </div>
        <button type="button" class="btn btn-primary"
                th:if="${todayAttendance == null}"
                onclick="openCheckModal('in')">â° ì¶œê·¼ ì²´í¬</button>
        <button type="button" class="btn btn-primary" disabled
                th:unless="${todayAttendance == null}"
                style="opacity:0.5;cursor:not-allowed;">âœ“ ì¶œê·¼ ì™„ë£Œ</button>
      </div>

      <!-- í†µê³„ ì¹´ë“œ -->
      <div class="stats-row">
        <div class="stat-card c-blue fu">
          <div class="sc-bar"></div>
          <div class="stat-icon">ğŸ“‹</div>
          <div class="stat-num" th:text="${attendanceCount}">12</div>
          <div class="stat-label">ì´ë²ˆë‹¬ ì¶œê·¼ì¼</div>
          <div class="stat-chip up">ì •ìƒ ì¶œê·¼ ì¤‘</div>
        </div>
        <div class="stat-card c-green fu">
          <div class="sc-bar"></div>
          <div class="stat-icon">âœ…</div>
          <div class="stat-num" th:text="${approvalCount}">3</div>
          <div class="stat-label">ëŒ€ê¸° ì¤‘ì¸ ê²°ì¬</div>
          <div class="stat-chip info">í™•ì¸ í•„ìš”</div>
        </div>
        <div class="stat-card c-yellow fu">
          <div class="sc-bar"></div>
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-num" th:text="${scheduleCount}">5</div>
          <div class="stat-label">ì´ë²ˆì£¼ ì¼ì •</div>
          <div class="stat-chip up">ì¼ì • ìˆìŒ</div>
        </div>
        <div class="stat-card c-red fu">
          <div class="sc-bar"></div>
          <div class="stat-icon">âœ‰ï¸</div>
          <div class="stat-num" th:text="${unreadMessageCount}">8</div>
          <div class="stat-label">ì½ì§€ ì•Šì€ ìª½ì§€</div>
          <div class="stat-chip warn">í™•ì¸ í•„ìš”</div>
        </div>
      </div>

      <!-- ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ -->
      <div class="dash-grid">

        <!-- ìµœì‹  ê³µì§€ -->
        <div class="card fu">
          <div class="card-header">
            <span class="card-title">ğŸ“¢ ìµœì‹  ê³µì§€ì‚¬í•­</span>
            <a th:href="@{/board/notice}" style="font-size:12px;color:var(--accent);font-weight:600;">ì „ì²´ë³´ê¸° â†’</a>
          </div>
          <div class="card-body" style="padding:13px 18px;">
            <div th:each="notice : ${recentNotices}" class="notice-item"
                 th:onclick="|location.href='@{/board/notice/detail(id=${notice.boardId})}'|">
              <div>
                <div class="ni-title" th:text="${notice.title}">ê³µì§€ ì œëª©</div>
                <div class="ni-meta">
                  <span th:text="${notice.writerName}">ê´€ë¦¬ì</span> Â·
                  <span th:text="${#temporals.format(notice.createdAt, 'MM.dd')}">06.20</span>
                </div>
              </div>
            </div>
            <div th:if="${#lists.isEmpty(recentNotices)}"
                 style="text-align:center;padding:20px;color:var(--text-muted);font-size:13px;">
              ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <!-- ì˜¤ëŠ˜ì˜ ê·¼íƒœ -->
        <div class="card fu">
          <div class="card-header">
            <span class="card-title">â± ì˜¤ëŠ˜ì˜ ê·¼íƒœ</span>
            <span class="badge badge-green"
                  th:text="${todayAttendance != null ? todayAttendance.status : '-'}">ì •ìƒ</span>
          </div>
          <div class="card-body">
            <!-- ì¶œê·¼ -->
            <div class="att-row">
              <div>
                <div class="att-label">ì¶œê·¼ ì‹œê°„</div>
                <div class="att-time"
                     th:text="${todayAttendance != null and todayAttendance.checkIn != null}
                               ? ${#temporals.format(todayAttendance.checkIn, 'HH:mm')} : '--:--'">--:--</div>
              </div>
              <span class="badge badge-green"
                    th:if="${todayAttendance != null and todayAttendance.checkIn != null}">âœ“ ì™„ë£Œ</span>
            </div>
            <!-- í‡´ê·¼ -->
            <div class="att-row">
              <div>
                <div class="att-label">í‡´ê·¼ ì‹œê°„</div>
                <div class="att-time"
                     th:text="${todayAttendance != null and todayAttendance.checkOut != null}
                               ? ${#temporals.format(todayAttendance.checkOut, 'HH:mm')} : '--:--'">--:--</div>
              </div>
              <button type="button" class="att-btn out"
                      th:if="${todayAttendance != null and todayAttendance.checkIn != null and todayAttendance.checkOut == null}"
                      onclick="openCheckModal('out')">í‡´ê·¼ ì²´í¬</button>
            </div>
            <!-- ì´ë²ˆë‹¬ ìš”ì•½ -->
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px;">
              <div style="text-align:center;padding:10px 6px;border-radius:9px;border:1px solid var(--border);cursor:default;"
                   th:style="${todayAttendance != null and todayAttendance.status == 'ì •ìƒ'} ? 'background:var(--success);' : 'background:var(--bg-page);'">
                <div style="font-family:'Sora',sans-serif;font-size:19px;font-weight:800;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'ì •ìƒ'} ? 'color:#fff;' : 'color:var(--success);'"
                     th:text="${normalCount}">0</div>
                <div style="font-size:11px;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'ì •ìƒ'} ? 'color:#fff;' : 'color:var(--text-muted);'">ì •ìƒ</div>
              </div>
              <div style="text-align:center;padding:10px 6px;border-radius:9px;border:1px solid var(--border);cursor:default;"
                   th:style="${todayAttendance != null and todayAttendance.status == 'ì§€ê°'} ? 'background:var(--warning);' : 'background:var(--bg-page);'">
                <div style="font-family:'Sora',sans-serif;font-size:19px;font-weight:800;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'ì§€ê°'} ? 'color:#fff;' : 'color:var(--warning);'"
                     th:text="${lateCount}">0</div>
                <div style="font-size:11px;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'ì§€ê°'} ? 'color:#fff;' : 'color:var(--text-muted);'">ì§€ê°</div>
              </div>
              <div style="text-align:center;padding:10px 6px;border-radius:9px;border:1px solid var(--border);cursor:default;"
                   th:style="${todayAttendance != null and todayAttendance.status == 'íœ´ê°€'} ? 'background:var(--accent);' : 'background:var(--bg-page);'">
                <div style="font-family:'Sora',sans-serif;font-size:19px;font-weight:800;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'íœ´ê°€'} ? 'color:#fff;' : 'color:var(--accent);'"
                     th:text="${vacationCount}">0</div>
                <div style="font-size:11px;"
                     th:style="${todayAttendance != null and todayAttendance.status == 'íœ´ê°€'} ? 'color:#fff;' : 'color:var(--text-muted);'">íœ´ê°€</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ë¯¸ë‹ˆ ìº˜ë¦°ë” -->
<div class="card fu">
  <div class="card-header"><span class="card-title">ğŸ“… ìº˜ë¦°ë”</span></div>
  <div class="card-body">
    <div class="cal-header">
      <button class="cal-nav">â€¹</button>
      <span class="cal-month" th:text="${#temporals.format(today, 'yyyyë…„ MMì›”')}">2025ë…„ 6ì›”</span>
      <button class="cal-nav">â€º</button>
    </div>
    <div class="cal-grid">
      <div class="cal-dh">ì¼</div><div class="cal-dh">ì›”</div>
      <div class="cal-dh">í™”</div><div class="cal-dh">ìˆ˜</div>
      <div class="cal-dh">ëª©</div><div class="cal-dh">ê¸ˆ</div>
      <div class="cal-dh">í† </div>
      <!-- ì´ì „ë‹¬ -->
      <div class="cal-cell other">25</div>
      <div class="cal-cell other">26</div>
      <div class="cal-cell other">27</div>
      <div class="cal-cell other">28</div>
      <div class="cal-cell other">29</div>
      <div class="cal-cell other">30</div>
      <div class="cal-cell other">31</div>
      <!-- ì´ë²ˆë‹¬ -->
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 1)} ? ' has-ev' : ''">1</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 2)} ? ' has-ev' : ''">2</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 3)} ? ' has-ev' : ''">3</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 4)} ? ' has-ev' : ''">4</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 5)} ? ' has-ev' : ''">5</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 6)} ? ' has-ev' : ''">6</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 7)} ? ' has-ev' : ''">7</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 8)} ? ' has-ev' : ''">8</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 9)} ? ' has-ev' : ''">9</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 10)} ? ' has-ev' : ''">10</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 11)} ? ' has-ev' : ''">11</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 12)} ? ' has-ev' : ''">12</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 13)} ? ' has-ev' : ''">13</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 14)} ? ' has-ev' : ''">14</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 15)} ? ' has-ev' : ''">15</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 16)} ? ' has-ev' : ''">16</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 17)} ? ' has-ev' : ''">17</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 18)} ? ' has-ev' : ''">18</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 19)} ? ' has-ev' : ''">19</div>
      <div class="cal-cell today" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 20)} ? ' has-ev' : ''">20</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 21)} ? ' has-ev' : ''">21</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 22)} ? ' has-ev' : ''">22</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 23)} ? ' has-ev' : ''">23</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 24)} ? ' has-ev' : ''">24</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 25)} ? ' has-ev' : ''">25</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 26)} ? ' has-ev' : ''">26</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 27)} ? ' has-ev' : ''">27</div>
      <div class="cal-cell" th:classappend="${scheduleDays != null and #lists.contains(scheduleDays, 28)} ? ' has-ev' : ''">28</div>
    </div>
  </div>
</div>

      </div><!-- /dash-grid -->
    </div><!-- /content-body -->
  </div><!-- /main-content -->
</div><!-- /app-wrap -->

<!-- ì¶œí‡´ê·¼ ëª¨ë‹¬ -->
<div id="check-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:999; align-items:center; justify-content:center;">
  <div class="card" style="width:400px; max-width:90%;">
    <div class="card-header">
      <span class="card-title" id="modal-title">ì¶œê·¼ ì²´í¬</span>
      <button onclick="closeCheckModal()" style="font-size:18px; color:var(--text-muted); cursor:pointer;">âœ•</button>
    </div>
    <div class="card-body">
      <form id="check-form" method="post">
        <div class="form-group">
          <label class="form-label">ì‹œê°„ ì„ íƒ</label>
          <input type="time" id="check-time" name="checkTime" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label">ìƒíƒœ</label>
          <select name="status" class="form-control">
            <option value="ì •ìƒ">ì •ìƒ</option>
            <option value="ì§€ê°">ì§€ê°</option>
            <option value="ì¡°í‡´">ì¡°í‡´</option>
            <option value="íœ´ê°€">íœ´ê°€</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-outline" onclick="closeCheckModal()">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn-primary" id="modal-submit-btn">ì¶œê·¼</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script th:src="@{/js/script.js}"></script>
<script>
  function openCheckModal(type) {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, '0');
    const mi = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('check-time').value = `${hh}:${mi}`;
    if (type === 'in') {
      document.getElementById('modal-title').textContent = 'â° ì¶œê·¼ ì²´í¬';
      document.getElementById('modal-submit-btn').textContent = 'ì¶œê·¼';
      document.getElementById('check-form').action = '/attendance/check-in';
    } else {
      document.getElementById('modal-title').textContent = 'ğŸ  í‡´ê·¼ ì²´í¬';
      document.getElementById('modal-submit-btn').textContent = 'í‡´ê·¼';
      document.getElementById('check-form').action = '/attendance/check-out';
    }
    document.getElementById('check-modal').style.display = 'flex';
  }

  function closeCheckModal() {
    document.getElementById('check-modal').style.display = 'none';
  }

  document.getElementById('check-modal').addEventListener('click', function(e) {
    if (e.target === this) closeCheckModal();
  });
</script>
</body>
</html>